# render.yaml - plantilla para desplegar VecinAPP en Render
# Reemplaza los placeholders antes de usar. No incluyas secretos en el repo.

services:
  - type: web
    name: vecinapp-backend
    env: node
    region: oregon
    plan: starter
    autoDeploy: true
    # Instalar también devDependencies (tipos) aunque NODE_ENV=production
    buildCommand: cd backend && npm install --include=dev && npm run build
    startCommand: sh -lc "cd backend && npx prisma generate && npx prisma migrate deploy && npm run start:prod"
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: NODE_VERSION
        value: "20"
      - key: FRONTEND_URL
        value: "https://<FRONTEND-URL>"
      - key: DATABASE_URL
        fromDatabase:
          name: vecinapp-db
          property: connectionString

  - type: web
    name: vecinapp-frontend
    env: static
    buildCommand: cd frontend && npm install --include=dev && npm run build
    staticPublishPath: frontend/dist
    envVars:
      - key: VITE_BACKEND_URL
        value: "https://<BACKEND-URL>"

databases:
  - name: vecinapp-db
    databaseName: vecinapp
    region: oregon

# Notas:
# - Render creará la base de datos y te dará un DATABASE_URL. Copiala en las Environment
#   variables del servicio `vecinapp-backend` (Settings -> Environment) como `DATABASE_URL`.
# - Añade en el dashboard de Render los secrets:
#     JWT_SECRET, REFRESH_TOKEN_SECRET, ACCESS_TOKEN_EXP, REFRESH_TOKEN_EXP
# - Ajusta `region`, `plan` y `repo` según tus preferencias.
# - Evita guardar secretos en el repo. Usa el dashboard de Render para variables sensibles.
